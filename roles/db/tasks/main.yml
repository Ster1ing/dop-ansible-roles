
- name: Update APT cache
  apt:
    update_cache: yes

- name: Install PostgreSQL and psycopg2 (Python library for PostgreSQL)
  apt:
    name: "{{ item }}"
  loop:
    - postgresql
    - postgresql-contrib
    - python3-psycopg2  # Install psycopg2 for Python 3

- name: Configure PostgreSQL authentication
  template:
    src: pg_hba.conf.j2
    dest: /etc/postgresql/14/main/pg_hba.conf
  notify: restart postgresql

- name: "Start and enable services"
  service: "name={{ item }} state=started enabled=yes"
  with_items:
  - postgresql

- name: Create a PostgreSQL database
  postgresql_db:
    name: "{{ db_name }}"  # Replace with your desired database name
    state: present

- name: Create a PostgreSQL user and grant privileges
  postgresql_user:
    db: "{{ db_name }}"   # Replace with your desired database name
    name: "{{ db_user }}"   # Replace with your desired username
    password: "{{ db_pass }}"  # Replace with your desired password
    priv: "{{ db_name }}.*:ALL"
    